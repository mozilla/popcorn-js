<!DOCTYPE html>
<html>
  <head>
    <title>Popcorn Test Suite</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../qunit/qunit.css" type="text/css" media="screen">
    <script src="../../jquery.js"></script>
    <script src="../../qunit/qunit.js"></script>
    <script src="../../../popcorn.js"></script>
    <script src="../../popcorn.inject.js"></script>
    <script>
      test( "Popcorn.util.toSeconds" , function() {
        var framerate = 24,
            storedStartTime,
            storedEndTime,
            areEquivalent,
            currentPeriod,
            startTimeStr,
            endTimeStr,
            message;

        //Time period data
        //The correct times that specify frame are calculated with a framerate of
        //24fps. Quotation is mixes (single and double) for testing purposes.
        var timePeriods = [
          {
            //Testing double quotes
            start: "01.234",
            end: "4.003",
            correctStartTime: 1.234,
            correctEndTime: 4.003
          },
          {
            //Tesing actual numbers
            start: 5.333,
            end: 6,
            correctStartTime: 5.333,
            correctEndTime: 6.000
          },
          {
            //Testing times in different data types (number and string)
            start: 6.004,
            end: "6.78",
            correctStartTime: 6.004,
            correctEndTime: 6.780
          },
          {
            //Testing times in different data types (string and number)
            start: "8.090",
            end: 9.11111111,
            correctStartTime: 8.090,
            correctEndTime: 9.11111111
          },
          {
            //Testing double quotes
            start: "10;4",
            end: "10;17",
            correctStartTime: 10.1666,
            correctEndTime: 10.7083
          },
          {
            //Testing single quotes
            start: '12;1',
            end: '13;2',
            correctStartTime: 12.0416,
            correctEndTime: 13.0833
          },
          {
            //Testing mixed quotes
            start: "20;11",
            end: '23;17',
            correctStartTime: 20.4583,
            correctEndTime: 23.7083
          },
          {
            //Testing mixed quotes
            start: '27;7',
            end: "27;22",
            correctStartTime: 27.2916,
            correctEndTime: 27.9166
          },
          {
            //Testing double quotes
            start: "12:04;12",
            end: "22:59;23",
            correctStartTime: 724.5,
            correctEndTime: 1379.9583
          },
          {
            //Testing single quotes
            start: '1:48:27;9',
            end: '3:23:15;1',
            correctStartTime: 6507.375,
            correctEndTime: 12195.0416
          },
          {
            //Testing mixed quotes
            start: '12:56;7',
            end: "2:02:42;8",
            correctStartTime: 776.2916,
            correctEndTime: 7362.3333
          }
        ];

        var equivalentTimes = function( testedTime, correctTime ) {
          var tolerance = 0.0001;
          return ( testedTime < ( correctTime + tolerance ) ) &&
                 ( testedTime > ( correctTime - tolerance ) );
        };

        var logMessage = function( timeStr, correctTime, incorrectTime ) {
          return "Time stored in seconds for '" + timeStr +
                 "' should be " + correctTime +
                 ". Time stored was " + incorrectTime;
        };

        for ( var periodsIdx = 0, timPeriodsLength = timePeriods.length; periodsIdx < timPeriodsLength; periodsIdx++ ) {
          currentPeriod = timePeriods[ periodsIdx ];
          startTimeStr = currentPeriod.start;
          endTimeStr = currentPeriod.end;

          storedStartTime = Popcorn.util.toSeconds( startTimeStr, framerate );
          storedEndTime = Popcorn.util.toSeconds( endTimeStr, framerate );

          message = logMessage(
            startTimeStr,
            currentPeriod.correctStartTime,
            storedStartTime
          );

          areEquivalent = equivalentTimes( storedStartTime, currentPeriod.correctStartTime );
          equal( areEquivalent, true, message );

          message = logMessage(
            endTimeStr,
            currentPeriod.correctEndTime,
            storedEndTime
          );

          areEquivalent = equivalentTimes( storedEndTime, currentPeriod.correctEndTime ) ;
          equal( areEquivalent, true, message );
        }
      });
    </script>
  </head>
  <body>
    <h1 id="qunit-header">Popcorn.js Test Suite[ Core - Popcorn.util.toSeconds ]</h1>
    <h2 id="qunit-banner"></h2>
    <div id="qunit-testrunner-toolbar"></div>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>
    <div id="qunit-fixture">
    </div>
  </body>
</html>

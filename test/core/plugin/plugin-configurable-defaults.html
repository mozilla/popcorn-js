<!DOCTYPE html>
<html>
  <head>
    <title>Popcorn Test Suite</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../qunit/qunit.css" type="text/css" media="screen">
    <script src="../../jquery.js"></script>
    <script src="../../qunit/qunit.js"></script>
    <script src="../../../popcorn.js"></script>
    <script src="../../popcorn.inject.js"></script>
    <script>
      asyncTest( "Configurable Defaults", function() {

        var expects = 14,
            count = 0,
            p;

        function plus() {
          if ( ++count === expects ) {
            [ "configurable", "multiconfig", "overridden", "funtionInitDefaults" ].forEach(function( val ) {
              Popcorn.removePlugin( val );
              delete Popcorn.manifest[ val ];
            });
            p.destroy();
            start();
          }
        }

        Popcorn.plugin( "configurable", function() {
          return {
            _setup: function( options ) {

              options.persistant = true;

              equal( options.target, "foo", "options.target, 'foo' in configurable _setup" );
              plus();
            },
            start: function( event, options ) {

              ok( options.persistant, "options.persistant proves same object passed from _setup" );
              plus();
              // target: "foo"
              // text: "bar"
              // type: "thinger"
              equal( options.target, "foo", "options.target, 'foo' in configurable start" );
              plus();
              equal( options.text, "bar", "options.text, 'bar' in configurable start" );
              plus();
              equal( options.type, "thinger", "options.type, 'thinger' in configurable start" );
              plus();
            },
            end: function( event, options ) {
              ok( true, "end fired" );
              plus();
            }
          };
        },
        {
          about:{
            name: "Popcorn Configurable Plugin",
            version: "0.0",
            author: "Rick Waldron",
            website: ""
          },
          options: {
            target: "manifest"
          }
        });

        Popcorn.plugin( "multiconfig", function() {
          return {
            start: function( event, options ) {
              equal( options.target, "quux", "options.target, 'quux' in multiconfig start" );
              plus();
            },
            end: function( event, options ) {
              ok( true, "end fired" );
              plus();
            }
          };
        });

        Popcorn.plugin( "overridden", function() {
          return {
            _setup: function( options ) {
              equal( options.text, "hello!", "options.text, overriden with 'hello!' in overridden _setup" );
              plus();

              equal( options.target, "custom", "options.target, overriden with 'custom' in overridden _setup" ); plus();
            },
            start: function( event, options ) {
              equal( options.text, "hello!", "options.text, overriden with 'hello!' in overridden start" );
              plus();

              equal( options.target, "custom", "options.target, overriden with 'custom' in overridden start" );
              plus();
            },
            end: function( event, options ) {
              ok( true, "end fired" );
              plus();
            }
          };
        });

        Popcorn.plugin( "funtionInitDefaults", function( options ) {

          equal( options.defaultItem, "foo bar", "defaults work inside auto setup function" );
          plus();

          return {
            start: Popcorn.nop,
            end: Popcorn.nop
          };
        });

        p = Popcorn( "#video", {
                  defaults: {
                    overridden: {
                      target: "default"
                    }
                  }
                });

        p.defaults( "funtionInitDefaults", {
          defaultItem: "foo bar"
        });

        p.funtionInitDefaults({});

        p.defaults( "configurable", {

          // set a default element target id
          target: "foo"

        }).defaults([
          {
            multiconfig: {
              target: "quux"
            }
          },
          {
            configurable: {
              text: "bar",
              type: "thinger"
            }
          }
        ]).configurable({

          // all calls will have:
          // target: "foo"
          // text: "bar"
          // type: "thinger"
          start: 3,
          end: 4
        }).multiconfig({

          // all calls will have:
          // target: "quux"
          start: 4,
          end: 5
        }).overridden({

          // has a default set
          // we need limitless overriding
          start: 4,
          end: 5,
          target: "custom",
          text: "hello!"
        })

        p.on( "canplayall", function onReady() {
          this.off( "canplayall", onReady )
          this.on( "seeked", function onSeeked() {
            this.off( "seeked", onSeeked );
            this.play();
          });
          this.currentTime( 2 );
        });
      });
    </script>
  </head>
  <body>
    <h1 id="qunit-header">Popcorn.js Test Suite[ Plugin - Configurable Defaults ]</h1>
    <h2 id="qunit-banner"></h2>
    <div id="qunit-testrunner-toolbar"></div>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>
    <div id="qunit-fixture">
      <video id="video" class="dom-tests" data-custom="foo"
        style="width:300px"
        controls
        preload="auto">

        <source id="mp4"
          src="../../trailer.mp4"
          type='video/mp4; codecs="avc1, mp4a"'>

        <source id="ogv"
          src="../../trailer.ogv"
          type='video/ogg; codecs="theora, vorbis"'>

        <source id="webm"
          src="../../trailer.webm"
          type='video/webm; codecs="vp8, vorbis"'>

        <p>Your user agent does not support the HTML5 Video element.</p>

      </video>
    </div>
  </body>
</html>
